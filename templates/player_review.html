{% extends "index.html" %}

{% block content %}
<div class="container" style="max-width: 1200px; margin: 40px auto; padding: 0 20px;">

    <!-- ìƒë‹¨: ë’¤ë¡œê°€ê¸° + ì‹œì¦Œ-ì´ë¦„ + ë¦¬ë·° ì‘ì„± (í•œ ì¤„) -->
    <div style="background: var(--card-bg); padding: 20px 30px; border-radius: 12px; margin-bottom: 30px;">
        <div style="display: flex; align-items: center; justify-content: space-between; gap: 20px;">
            <!-- ì™¼ìª½: ë’¤ë¡œê°€ê¸° -->
            <a href="javascript:history.back()" class="back-btn"
                style="display: inline-block; padding: 10px 20px; border: 2px solid #667eea; border-radius: 8px; color: var(--text-primary); text-decoration: none; transition: all 0.3s; white-space: nowrap;">
                â† ë’¤ë¡œ ê°€ê¸°
            </a>

            <!-- ì¤‘ì•™: ì‹œì¦Œ + ì´ë¦„ -->
            <div style="display: flex; align-items: center; gap: 15px; flex: 1; justify-content: center;">
                <img src="{{ card.image_info.season_img }}" alt="{{ card.season_name }}"
                    style="width: 60px; height: 60px; object-fit: contain;">
                <h2 style="color: var(--text-primary); margin: 0; font-size: 2.5rem; font-weight: 700;">
                    {{ card.player_name }}
                </h2>
            </div>

            <!-- âœ… ì˜¤ë¥¸ìª½: ë¦¬ë·° ì‘ì„± ë²„íŠ¼ -->
            {% if current_user.is_authenticated %}
            <button id="toggleWriteBtn" onclick="toggleWriteForm()"
                style="padding: 10px 20px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; white-space: nowrap;">
                âœï¸ ë¦¬ë·° ì‘ì„±
            </button>
            {% else %}
            <button onclick="showLoginAlert()"
                style="padding: 10px 20px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; white-space: nowrap;">
                âœï¸ ë¦¬ë·° ì‘ì„±
            </button>
            {% endif %}
        </div>
    </div>

    <!-- í›„ê¸° ì‘ì„± í¼ (ê¸°ë³¸ ìˆ¨ê¹€) -->
    {% if current_user.is_authenticated %}
    <div id="writeForm"
        style="display: none; background: var(--card-bg); padding: 30px; border-radius: 12px; margin-bottom: 30px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h4 style="color: var(--text-primary); margin: 0;">âœï¸ í›„ê¸° ì‘ì„±í•˜ê¸°</h4>
            <button onclick="toggleWriteForm()"
                style="padding: 6px 12px; background: var(--bg-secondary); color: var(--text-secondary); border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer;">
                ë‹«ê¸°
            </button>
        </div>

        <form method="POST" action="/player_review/{{ card.spid }}/comment">
            <!-- ì‘ì„±ì -->
            <div style="margin-bottom: 15px;">
                <label style="color: var(--text-primary); font-weight: 500; margin-bottom: 8px; display: block;">
                    ì‘ì„±ì
                </label>
                <input type="text" name="author" value="ìµëª…" maxlength="100" class="form-control"
                    style="background: var(--bg-main); border: 1px solid var(--border-color); color: var(--text-primary); padding: 10px; border-radius: 6px;">
                <small style="color: var(--text-secondary); margin-top: 5px; display: block;">
                    ğŸ’¡ ì¶”í›„ ë¡œê·¸ì¸ ê¸°ëŠ¥ì´ ì¶”ê°€ë©ë‹ˆë‹¤
                </small>
            </div>

            <!-- í‰ì  (ì„ íƒ) -->
            <div style="margin-bottom: 15px;">
                <label style="color: var(--text-primary); font-weight: 500; margin-bottom: 8px; display: block;">
                    í‰ì  (ì„ íƒ)
                </label>
                <select name="rating" class="form-select"
                    style="background: var(--bg-main); border: 1px solid var(--border-color); color: var(--text-primary); padding: 10px; border-radius: 6px;">
                    <option value="">ì„ íƒ ì•ˆ í•¨</option>
                    <option value="10">â­ 10ì  - ìµœê³ !</option>
                    <option value="9">â­ 9ì  - ë§¤ìš° ì¢‹ìŒ</option>
                    <option value="8">â­ 8ì  - ì¢‹ìŒ</option>
                    <option value="7">â­ 7ì  - ê´œì°®ìŒ</option>
                    <option value="6">â­ 6ì  - ë³´í†µ</option>
                    <option value="5">â­ 5ì  - ê·¸ì € ê·¸ëŸ¼</option>
                    <option value="4">â­ 4ì  - ì•„ì‰¬ì›€</option>
                    <option value="3">â­ 3ì  - ë³„ë¡œ</option>
                    <option value="2">â­ 2ì  - ë‚˜ì¨</option>
                    <option value="1">â­ 1ì  - ìµœì•…</option>
                </select>
            </div>

            <!-- í›„ê¸° ë‚´ìš© -->
            <div style="margin-bottom: 20px;">
                <label style="color: var(--text-primary); font-weight: 500; margin-bottom: 8px; display: block;">
                    í›„ê¸° ë‚´ìš© <span style="color: #ff4444;">*</span>
                </label>
                <textarea name="content" required rows="5" placeholder="ì´ ì„ ìˆ˜ë¥¼ ì‚¬ìš©í•œ ê²½í—˜ì„ ê³µìœ í•´ì£¼ì„¸ìš”..." class="form-control"
                    style="background: var(--bg-main); border: 1px solid var(--border-color); color: var(--text-primary); padding: 12px; border-radius: 6px; resize: vertical;"></textarea>
            </div>

            <!-- ì‘ì„± ë²„íŠ¼ -->
            <button type="submit" class="btn btn-success" style="padding: 10px 30px; font-weight: 600;">
                ì‘ì„± ì™„ë£Œ
            </button>
        </form>
    </div>
    {% endif %}

    <!-- í›„ê¸° ëª©ë¡ -->
    <div style="background: var(--card-bg); padding: 30px; border-radius: 12px; margin-bottom: 30px;">
        <h3 style="color: var(--text-primary); margin-bottom: 20px;">
            ğŸ’¬ ì„ ìˆ˜ í›„ê¸° ({{ reviews|length }})
        </h3>

        {% if reviews %}
        <div style="display: flex; flex-direction: column; gap: 20px;">
            {% for review in reviews %}
            <div
                style="padding: 20px; background: var(--bg-secondary); border-radius: 8px; border-left: 3px solid var(--primary-color);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span style="color: var(--text-primary); font-weight: 600;">
                            {{ review.author_name or review.author_email }}
                        </span>
                        {% if review.position %}
                        <span
                            style="background: var(--primary-color); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.85rem;">
                            {{ review.position }}
                        </span>
                        {% endif %}
                        {% if review.rating %}
                        <span style="color: #fbbf24; font-weight: 600;">â­ {{ review.rating }}/10</span>
                        {% endif %}
                    </div>
                    <span style="color: var(--text-secondary); font-size: 0.9rem;">
                        {{ review.created_at.strftime('%m-%d %H:%M') }}
                    </span>
                </div>
                <p style="color: var(--text-primary); margin: 0; line-height: 1.6;">
                    {{ review.content }}
                </p>
                <div style="margin-top: 10px;">
                    <span style="color: var(--text-secondary); font-size: 0.9rem;">
                        ğŸ‘ {{ review.likes }}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
            <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ’­</div>
            <p>ì•„ì§ ì‘ì„±ëœ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
            <p style="font-size: 0.9rem;">ì²« ë²ˆì§¸ í›„ê¸°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
        </div>
        {% endif %}
    </div>

</div>

<script>
    function toggleWriteForm() {
        const form = document.getElementById('writeForm');
        const btn = document.getElementById('toggleWriteBtn');

        if (form.style.display === 'none') {
            form.style.display = 'block';
            btn.textContent = 'âŒ ë‹«ê¸°';
            form.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
            form.style.display = 'none';
            btn.textContent = 'âœï¸ ë¦¬ë·° ì‘ì„±';
        }
    }

    // âœ… ìƒˆë¡œ ì¶”ê°€
    function showLoginAlert() {
        alert('ì„ ìˆ˜ í›„ê¸°ë¥¼ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\n\nêµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ì‹œì‘í•˜ì„¸ìš”!');
        window.location.href = '/login';
    }
</script>

<style>
    /* ë‹¤í¬ëª¨ë“œ ì…€ë ‰íŠ¸ ì˜µì…˜ */
    [data-theme="dark"] .form-select option {
        background: #2d3748;
        color: #ffffff;
    }

    /* ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
    #toggleWriteBtn:hover {
        background: #059669 !important;
        transform: translateY(-2px);
    }
</style>

{% endblock %}