{% extends "index.html" %}

{% block content %}
<style>
    .back-btn {
        background: var(--bg-main);
        color: var(--primary-color);
        padding: 10px 20px;
        border-radius: 20px;
        text-decoration: none;
        display: inline-block;
        margin-bottom: 20px;
        transition: all 0.3s;
        border: 2px solid var(--primary-color);
        font-weight: 600;
    }

    .back-btn:hover {
        background: var(--primary-color);
        color: var(--bg-main);
        transform: translateX(-5px);
        box-shadow: 0 4px 15px var(--shadow-hover);
    }

    .header-section {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 30px;
        margin-bottom: 30px;
        align-items: center;
    }

    .vs-divider {
        font-size: 48px;
        font-weight: bold;
        color: var(--primary-color);
        text-align: center;
    }

    .player-header {
        text-align: center;
    }

    .player-image {
        width: 150px;
        height: 150px;
        object-fit: contain;
        border-radius: 15px;
        background: var(--bg-secondary);
        padding: 10px;
        margin-bottom: 15px;
    }

    .player-name-row {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-bottom: 10px;
    }

    .season-icon {
        width: 35px;
        height: 35px;
        object-fit: contain;
    }

    .player-name {
        font-size: 22px;
        font-weight: 700;
        color: var(--text-primary);
        margin: 0;
    }

    .salary-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 22px;
        height: 25px;
        background: var(--text-secondary);
        color: var(--bg-main);
        clip-path: polygon(50% 0%, 100% 30%, 100% 70%, 50% 100%, 0% 70%, 0% 30%);
        font-weight: bold;
        font-size: 12px;
    }

    .comparison-table {
        width: 100%;
        border-collapse: collapse;
    }

    .comparison-row {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 20px;
        padding: 12px 0;
        border-bottom: 1px solid var(--border-color);
        align-items: center;
    }

    .comparison-row:last-child {
        border-bottom: none;
    }

    .comparison-row.header-row {
        border-bottom: none;
    }

    .left-value {
        text-align: right;
        color: var(--text-primary);
        font-size: 15px;
        padding-right: 20px;
    }

    .center-label {
        text-align: center;
        color: var(--text-secondary);
        font-weight: 600;
        font-size: 14px;
        width: 120px;
        min-width: 120px;
        max-width: 120px;
        padding: 8px 10px;
        background: var(--bg-secondary);
        border-radius: 8px;
    }

    .right-value {
        text-align: left;
        color: var(--text-primary);
        font-size: 15px;
        padding-left: 20px;
    }

    .nation-content {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .nation-content.left {
        justify-content: flex-end;
    }

    .nation-content.right {
        justify-content: flex-start;
    }

    .nation-flag {
        width: 24px;
        height: 18px;
        object-fit: contain;
    }

    .traits-content {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
    }

    .traits-content.left {
        justify-content: flex-end;
    }

    .traits-content.right {
        justify-content: flex-start;
    }

    .trait-icon {
        width: 28px;
        height: 28px;
        object-fit: contain;
    }

    .price-comparison-container {
        max-height: 200px;
        overflow-y: overlay;
        background: var(--bg-secondary);
        border-radius: 10px;
        padding: 10px 20px;
        margin-bottom: 20px;
    }

    .price-comparison-container::-webkit-scrollbar {
        width: 8px;
    }

    .price-comparison-container::-webkit-scrollbar-track {
        background: transparent;
    }

    .price-comparison-container::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 4px;
    }

    .price-comparison-container::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.25);
    }

    .price-comparison-row {
        display: grid;
        grid-template-columns: 1fr 50px 1fr;
        gap: 20px;
        align-items: center;
        padding: 10px 0;
        padding-left: 8px;
    }

    .price-left {
        text-align: right;
        padding-right: 20px;
    }

    .price-center {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .price-right {
        text-align: left;
        padding-left: 20px;
    }

    .price-display {
        font-size: 13px;
        color: var(--text-primary);
        font-weight: 500;
    }

    .enhance-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 50px;
        height: 28px;
        border-radius: 6px;
        font-weight: bold;
        font-size: 14px;
    }

    .enhance-level-1 {
        background: #808080;
        color: white;
    }

    .enhance-level-2-4 {
        background: #CD7F32;
        color: #333;
    }

    .enhance-level-5-7 {
        background: #C0C0C0;
        color: #333;
    }

    .enhance-level-8-10 {
        background: #FFD700;
        color: #333;
    }

    .enhance-level-11-13 {
        background: #DDA0DD;
        color: white;
    }

    .simulators-wrapper {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 20px;
        align-items: start;
        padding: 15px 20px;
        background: var(--bg-secondary);
        border-radius: 10px;
        margin-bottom: 20px;
    }

    .simulator-section {
        display: contents;
    }

    .simulator-controls-left {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
    }

    .simulator-controls-right {
        display: flex;
        gap: 10px;
        justify-content: flex-start;
    }

    .simulator-divider {
        width: 100px;
    }

    .simulator-wrapper {
        position: relative;
        min-width: 120px;
    }

    .simulator-select {
        width: 100%;
        background: var(--bg-main);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
        appearance: none;
        padding: 8px 30px 8px 12px;
        cursor: pointer;
        border-radius: 6px;
        font-size: 14px;
    }

    .simulator-select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem var(--shadow-focus);
    }

    .select-arrow {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
        color: var(--text-muted);
        font-size: 10px;
    }

    .stats-comparison-container {
        background: var(--bg-secondary);
        border-radius: 10px;
        padding: 10px 20px;
    }

    .stat-comparison-row {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 20px;
        align-items: center;
        padding: 8px 0;
    }

    .stat-left {
        text-align: right;
        padding-right: 20px;
    }

    .stat-center {
        text-align: center;
        width: 130px;
        min-width: 130px;
        max-width: 130px;
        padding: 6px 10px;
        background: var(--bg-main);
        border-radius: 6px;
    }

    .stat-label {
        font-size: 13px;
        color: var(--text-secondary);
        font-weight: 600;
    }

    .stat-right {
        text-align: left;
        padding-left: 20px;
    }

    .stat-value {
        font-size: 17px;
        font-weight: bold;
        display: inline-block;
        min-width: 35px;
    }

    .stat-left .stat-value {
        text-align: right;
    }

    .stat-right .stat-value {
        text-align: left;
    }

    .stat-diff {
        color: #28a745;
        font-weight: bold;
        font-size: 13px;
        margin-left: 8px;
    }

    .stat-diff.left {
        margin-left: 0;
        margin-right: 8px;
    }

    .preferred-positions-box {
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 15px;
        background: var(--bg-main);
        border-radius: 10px;
        min-height: 100px;
    }

    .preferred-pos-item {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 18px;
        font-weight: bold;
    }

    .preferred-pos-item .position {
        min-width: 50px;
    }

    .preferred-pos-item .overall {
        color: var(--text-primary);
    }
</style>

<a href="javascript:history.back()" class="back-btn">← 뒤로 가기</a>
<!-- 상단 헤더: 이미지, 이름 -->
<div class="header-section">
    <!-- 왼쪽 플레이어 헤더 -->
    <div class="player-header">
        <img src="{{ card1.image_info.mini_faceon }}" class="player-image" alt="{{ card1.player_name }}">
        <div class="player-name-row">
            {% if card1.image_info.season_img %}
            <img src="{{ card1.image_info.season_img }}" alt="{{ card1.season_name }}" class="season-icon">
            {% endif %}
            <h3 class="player-name">{{ card1.player_name }}</h3>
        </div>
    </div>

    <!-- 중앙 VS -->
    <div class="vs-divider">VS</div>

    <!-- 오른쪽 플레이어 헤더 -->
    <div class="player-header">
        <img src="{{ card2.image_info.mini_faceon }}" class="player-image" alt="{{ card2.player_name }}">
        <div class="player-name-row">
            {% if card2.image_info.season_img %}
            <img src="{{ card2.image_info.season_img }}" alt="{{ card2.season_name }}" class="season-icon">
            {% endif %}
            <h3 class="player-name">{{ card2.player_name }}</h3>
        </div>
    </div>
</div>

<!-- 비교 테이블 -->
<div class="comparison-table">
    {% set TRAIT_MAPPING = {
    "아크로바틱 피니셔": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_50.png",
    "크로스 포쳐": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_51.png",
    "라인 브레이커": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_52.png",
    "와일드 태클러": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_53.png",
    "체이서": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_54.png",
    "2개의 심장": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_55.png",
    "파이터": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_56.png",
    "GK 빠른 반응": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_57.png",
    "선호 포지션 고집": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_00.png",
    "장거리 스로인": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_01.png",
    "파울 유도 선호": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_03.png",
    "유리몸": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_04.png",
    "강철몸": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_05.png",
    "주발 선호": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_06.png",
    "슬라이딩 태클 선호": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_07.png",
    "개인 플레이 선호": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_09.png",
    "트러블 메이커": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_11.png",
    "얼리 크로스 선호": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_12.png",
    "예리한 감아차기": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_13.png",
    "화려한 개인기": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_14.png",
    "긴 패스 선호": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_15.png",
    "중거리 슛 선호": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_16.png",
    "스피드 드리블러": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_17.png",
    "플레이 메이커": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_18.png",
    "GK 공격 가담": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_19.png",
    "GK 능숙한 펀칭": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_20.png",
    "GK 멀리 던지기": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_21.png",
    "파워 헤더": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_22.png",
    "GK 침착한 1:1 수비": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_23.png",
    "초 장거리 스로인": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_24.png",
    "아웃사이드 슈팅/크로스": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_25.png",
    "패스마스터": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_27.png",
    "승부욕": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_28.png",
    "화려한 걷어내기": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_29.png",
    "칩샷 선호": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_41.png",
    "테크니컬 드리블러": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_42.png",
    "스위퍼 키퍼": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_43.png",
    "GK 소극적 크로스 수비": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_48.png",
    "GK 적극적 크로스 수비": "https://fco.dn.nexoncdn.co.kr/live/externalAssets/common/traits/trait_icon_49.png"
    } %}

    <!-- 급여 -->
    <div class="comparison-row">
        <div class="left-value">
            {% set salary1 = card1.game_info.salary|default(0)|int %}
            {% set salary2 = card2.game_info.salary|default(0)|int %}
            {% if salary1 > salary2 %}
            <span class="stat-diff left">{{ salary1 - salary2 }} ▲</span>
            {% endif %}
            <span class="salary-badge">{{ salary1 }}</span>
        </div>
        <div class="center-label">급여</div>
        <div class="right-value">
            <span class="salary-badge">{{ salary2 }}</span>
            {% if salary2 > salary1 %}
            <span class="stat-diff">▲ {{ salary2 - salary1 }}</span>
            {% endif %}
        </div>
    </div>

    <!-- 신장 -->
    <div class="comparison-row">
        <div class="left-value">
            {% set height1_str = card1.basic_info.height|default('0cm') %}
            {% set height2_str = card2.basic_info.height|default('0cm') %}
            {% set height1 = height1_str.replace('cm', '')|int %}
            {% set height2 = height2_str.replace('cm', '')|int %}
            {% if height1 > height2 %}
            <span class="stat-diff left">{{ height1 - height2 }} ▲</span>
            {% endif %}
            {{ height1_str }}
        </div>
        <div class="center-label">신장</div>
        <div class="right-value">
            {{ height2_str }}
            {% if height2 > height1 %}
            <span class="stat-diff">▲ {{ height2 - height1 }}</span>
            {% endif %}
        </div>
    </div>

    <!-- 몸무게 -->
    <div class="comparison-row">
        <div class="left-value">
            {% set weight1_str = card1.basic_info.weight|default('0kg') %}
            {% set weight2_str = card2.basic_info.weight|default('0kg') %}
            {% set weight1 = weight1_str.replace('kg', '')|int %}
            {% set weight2 = weight2_str.replace('kg', '')|int %}
            {% if weight1 > weight2 %}
            <span class="stat-diff left">{{ weight1 - weight2 }} ▲</span>
            {% endif %}
            {{ weight1_str }}
        </div>
        <div class="center-label">몸무게</div>
        <div class="right-value">
            {{ weight2_str }}
            {% if weight2 > weight1 %}
            <span class="stat-diff">▲ {{ weight2 - weight1 }}</span>
            {% endif %}
        </div>
    </div>

    <!-- ✅ 체형 (새로 추가) -->
    <div class="comparison-row">
        <div class="left-value">
            {{ card1.basic_info.body_type|default('Unknown') }}
        </div>
        <div class="center-label">체형</div>
        <div class="right-value">
            {{ card2.basic_info.body_type|default('Unknown') }}
        </div>
    </div>

    <!-- 주발-약발 -->
    <div class="comparison-row">
        <div class="left-value">
            {% set pref_foot = card1.game_info.preferred_foot|default('') %}
            {% set weak_foot = card1.game_info.weak_foot|default('') %}
            {% if 'L' in pref_foot %}
            <strong>{{ pref_foot }}</strong>-{{ weak_foot }}
            {% else %}
            {{ weak_foot }}-<strong>{{ pref_foot }}</strong>
            {% endif %}
        </div>
        <div class="center-label">주발/약발</div>
        <div class="right-value">
            {% set pref_foot = card2.game_info.preferred_foot|default('') %}
            {% set weak_foot = card2.game_info.weak_foot|default('') %}
            {% if 'L' in pref_foot %}
            <strong>{{ pref_foot }}</strong>-{{ weak_foot }}
            {% else %}
            {{ weak_foot }}-<strong>{{ pref_foot }}</strong>
            {% endif %}
        </div>
    </div>

    <!-- 국적 -->
    <div class="comparison-row">
        <div class="left-value">
            <div class="nation-content left">
                {% if card1.image_info.nation_img %}
                <img src="{{ card1.image_info.nation_img }}" class="nation-flag" alt="{{ card1.basic_info.nation }}">
                {% endif %}
                <span>{{ card1.basic_info.nation }}</span>
            </div>
        </div>
        <div class="center-label">국적</div>
        <div class="right-value">
            <div class="nation-content right">
                <span>{{ card2.basic_info.nation }}</span>
                {% if card2.image_info.nation_img %}
                <img src="{{ card2.image_info.nation_img }}" class="nation-flag" alt="{{ card2.basic_info.nation }}">
                {% endif %}
            </div>
        </div>
    </div>

    <!-- 고유특성 -->
    <div class="comparison-row">
        <div class="left-value">
            {% if card1.game_info.traits %}
            <div class="traits-content left">
                {% for trait in card1.game_info.traits %}
                {% if trait in TRAIT_MAPPING %}
                <img src="{{ TRAIT_MAPPING[trait] }}" class="trait-icon" alt="{{ trait }}" title="{{ trait }}">
                {% endif %}
                {% endfor %}
            </div>
            {% endif %}
        </div>
        <div class="center-label">고유특성</div>
        <div class="right-value">
            {% if card2.game_info.traits %}
            <div class="traits-content right">
                {% for trait in card2.game_info.traits %}
                {% if trait in TRAIT_MAPPING %}
                <img src="{{ TRAIT_MAPPING[trait] }}" class="trait-icon" alt="{{ trait }}" title="{{ trait }}">
                {% endif %}
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>

    <!-- 시세 -->
    {% if card1.bp1 or card2.bp1 %}
    <div class="comparison-row header-row">
        <div class="left-value"></div>
        <div class="center-label">시세</div>
        <div class="right-value"></div>
    </div>

    <!-- 시세 상세 (스크롤 영역) -->
    <div class="price-comparison-container">
        {% for i in range(1, 14) %}
        {% set price1 = card1['bp' ~ i] %}
        {% set price2 = card2['bp' ~ i] %}
        {% if (price1 and price1 > 0) or (price2 and price2 > 0) %}
        <div class="price-comparison-row">
            <!-- 왼쪽 가격 -->
            <div class="price-left">
                {% if price1 and price1 > 0 %}
                <span class="price-display">
                    {% if price1 >= 10000000000000000 %}
                    ({{ "%.1f경" % (price1 / 10000000000000000) }})
                    {% elif price1 >= 1000000000000 %}
                    ({{ "%.1f조" % (price1 / 1000000000000) }})
                    {% elif price1 >= 100000000 %}
                    ({{ "%.1f억" % (price1 / 100000000) }})
                    {% elif price1 >= 10000 %}
                    ({{ "%d만" % (price1 / 10000) }})
                    {% else %}
                    ({{ "{:,}".format(price1) }})
                    {% endif %}
                    {{ "{:,}".format(price1) }}
                </span>
                {% endif %}
            </div>

            <!-- 강화 단계 -->
            <div class="price-center">
                <div class="enhance-badge 
                {% if i == 1 %}enhance-level-1
                {% elif i <= 4 %}enhance-level-2-4
                {% elif i <= 7 %}enhance-level-5-7
                {% elif i <= 10 %}enhance-level-8-10
                {% else %}enhance-level-11-13
                {% endif %}">
                    {{ i }}
                </div>
            </div>

            <!-- 오른쪽 가격 -->
            <div class="price-right">
                {% if price2 and price2 > 0 %}
                <span class="price-display">
                    {{ "{:,}".format(price2) }}
                    {% if price2 >= 10000000000000000 %}
                    ({{ "%.1f경" % (price2 / 10000000000000000) }})
                    {% elif price2 >= 1000000000000 %}
                    ({{ "%.1f조" % (price2 / 1000000000000) }})
                    {% elif price2 >= 100000000 %}
                    ({{ "%.1f억" % (price2 / 100000000) }})
                    {% elif price2 >= 10000 %}
                    ({{ "%d만" % (price2 / 10000) }})
                    {% else %}
                    ({{ "{:,}".format(price2) }})
                    {% endif %}
                </span>
                {% endif %}
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    <!-- 세부 스탯 -->
    <div class="comparison-row header-row">
        <div class="left-value"></div>
        <div class="center-label">세부 스탯</div>
        <div class="right-value"></div>
    </div>

    <!-- 시뮬레이터 컨트롤 (양쪽) -->
    <div class="simulators-wrapper">
        <!-- 왼쪽 카드 시뮬레이터 -->
        <div class="simulator-section">
            <div class="simulator-controls-left">
                <div class="simulator-wrapper">
                    <select class="form-select simulator-select" id="enhanceLevel1" data-card="1">
                        <option value="0" selected>강화</option>
                        <option value="1" class="enhance-level-1">+1</option>
                        <option value="2" class="enhance-level-2-4">+2</option>
                        <option value="3" class="enhance-level-2-4">+3</option>
                        <option value="4" class="enhance-level-2-4">+4</option>
                        <option value="5" class="enhance-level-5-7">+5</option>
                        <option value="6" class="enhance-level-5-7">+6</option>
                        <option value="7" class="enhance-level-5-7">+7</option>
                        <option value="8" class="enhance-level-8-10">+8</option>
                        <option value="9" class="enhance-level-8-10">+9</option>
                        <option value="10" class="enhance-level-8-10">+10</option>
                        <option value="11" class="enhance-level-11-13">+11</option>
                        <option value="12" class="enhance-level-11-13">+12</option>
                        <option value="13" class="enhance-level-11-13">+13</option>
                    </select>
                    <span class="select-arrow">▼</span>
                </div>

                <div class="simulator-wrapper">
                    <select class="form-select simulator-select" id="adaptLevel1" data-card="1">
                        <option value="0" selected>적응도</option>
                        <option value="1">Lv.1</option>
                        <option value="2">Lv.2</option>
                        <option value="3">Lv.3</option>
                        <option value="4">Lv.4</option>
                        <option value="5">Lv.5</option>
                    </select>
                    <span class="select-arrow">▼</span>
                </div>

                <div class="simulator-wrapper">
                    <select class="form-select simulator-select" id="teamColor1" data-card="1">
                        <option value="0" selected>팀컬러</option>
                        <option value="1">+1</option>
                        <option value="2">+2</option>
                        <option value="3">+3</option>
                        <option value="4">+4</option>
                        <option value="5">+5</option>
                        <option value="6">+6</option>
                        <option value="7">+7</option>
                        <option value="8">+8</option>
                        <option value="9">+9</option>
                    </select>
                    <span class="select-arrow">▼</span>
                </div>
            </div>
        </div>

        <!-- 중앙 빈공간 -->
        <div class="simulator-divider"></div>

        <!-- 오른쪽 카드 시뮬레이터 -->
        <div class="simulator-section">
            <div class="simulator-controls-right">
                <div class="simulator-wrapper">
                    <select class="form-select simulator-select" id="enhanceLevel2" data-card="2">
                        <option value="0" selected>강화</option>
                        <option value="1" class="enhance-level-1">+1</option>
                        <option value="2" class="enhance-level-2-4">+2</option>
                        <option value="3" class="enhance-level-2-4">+3</option>
                        <option value="4" class="enhance-level-2-4">+4</option>
                        <option value="5" class="enhance-level-5-7">+5</option>
                        <option value="6" class="enhance-level-5-7">+6</option>
                        <option value="7" class="enhance-level-5-7">+7</option>
                        <option value="8" class="enhance-level-8-10">+8</option>
                        <option value="9" class="enhance-level-8-10">+9</option>
                        <option value="10" class="enhance-level-8-10">+10</option>
                        <option value="11" class="enhance-level-11-13">+11</option>
                        <option value="12" class="enhance-level-11-13">+12</option>
                        <option value="13" class="enhance-level-11-13">+13</option>
                    </select>
                    <span class="select-arrow">▼</span>
                </div>

                <div class="simulator-wrapper">
                    <select class="form-select simulator-select" id="adaptLevel2" data-card="2">
                        <option value="0" selected>적응도</option>
                        <option value="1">Lv.1</option>
                        <option value="2">Lv.2</option>
                        <option value="3">Lv.3</option>
                        <option value="4">Lv.4</option>
                        <option value="5">Lv.5</option>
                    </select>
                    <span class="select-arrow">▼</span>
                </div>

                <div class="simulator-wrapper">
                    <select class="form-select simulator-select" id="teamColor2" data-card="2">
                        <option value="0" selected>팀컬러</option>
                        <option value="1">+1</option>
                        <option value="2">+2</option>
                        <option value="3">+3</option>
                        <option value="4">+4</option>
                        <option value="5">+5</option>
                        <option value="6">+6</option>
                        <option value="7">+7</option>
                        <option value="8">+8</option>
                        <option value="9">+9</option>
                    </select>
                    <span class="select-arrow">▼</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 세부 스탯 비교 리스트 -->
    <div class="stats-comparison-container"
        style="display: grid; grid-template-columns: 260px 1fr 260px; gap: 20px; align-items: start;">
        <!-- 왼쪽: 카드1 선호 포지션 -->
        <div style="display: flex; flex-direction: column; gap: 15px; padding-top: 20px; padding-left: 85px;">
            {% for pos in card1.stats_info.main_overall.preferred_positions %}
            <div style="text-align: right;">
                <div style="font-size: 20px; font-weight: bold; margin-bottom: -5px;
                {% if pos.position in ['ST', 'CF', 'RW', 'LW'] %}
                color: #e74c3c;
                {% elif pos.position in ['CAM', 'LM', 'RM', 'CM', 'CDM'] %}
                color: #27ae60;
                {% elif pos.position in ['CB', 'RB', 'LB', 'RWB', 'LWB', 'SW'] %}
                color: #3498db;
                {% elif pos.position == 'GK' %}
                color: #f39c12;
                {% else %}
                color: var(--text-secondary);
                {% endif %}">{{ pos.position }}</div>
                <div class="preferred-pos-value" data-card="1" data-position="{{ pos.position }}"
                    data-original="{{ pos.overall }}"
                    style="font-size: 52px; font-weight: bold; color: var(--text-primary); line-height: 1;">
                    {{ pos.overall }}
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- 중앙: 세부 스탯 리스트 -->
        <div>
            {% set detailed_stats = [
            '속력', '가속력', '골 결정력', '슛 파워', '중거리 슛', '위치 선정', '발리슛',
            '페널티 킥', '짧은 패스', '시야', '크로스', '긴 패스', '프리킥', '커브',
            '드리블', '볼 컨트롤', '민첩성', '밸런스', '반응 속도', '대인 수비', '태클',
            '가로채기', '헤더', '슬라이딩 태클', '몸싸움', '스태미너', '적극성', '점프',
            '침착성', 'GK 다이빙', 'GK 핸들링', 'GK 킥', 'GK 반응속도', 'GK 위치 선정'
            ] %}

            {% for stat_name in detailed_stats %}
            {% set stat1 = card1.stats_info.detailed_stats.get(stat_name) %}
            {% set stat2 = card2.stats_info.detailed_stats.get(stat_name) %}
            {% if stat1 is not none or stat2 is not none %}
            <div class="stat-comparison-row">
                <!-- 왼쪽 스탯값 -->
                <div class="stat-left">
                    {% if stat1 is not none %}
                    <span class="stat-value" data-card="1" data-stat="{{ stat_name }}" data-original="{{ stat1 }}">{{
                        stat1 }}</span>
                    {% endif %}
                </div>

                <!-- 스탯명 -->
                <div class="stat-center">
                    <span class="stat-label">{{ stat_name }}</span>
                </div>

                <!-- 오른쪽 스탯값 -->
                <div class="stat-right">
                    {% if stat2 is not none %}
                    <span class="stat-value" data-card="2" data-stat="{{ stat_name }}" data-original="{{ stat2 }}">{{
                        stat2 }}</span>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>

        <!-- 오른쪽: 카드2 선호 포지션 -->
        <div style="display: flex; flex-direction: column; gap: 15px; padding-top: 20px; padding-right: 85px;">
            {% for pos in card2.stats_info.main_overall.preferred_positions %}
            <div style="text-align: left;">
                <div style="font-size: 20px; font-weight: bold; margin-bottom: -5px;
                {% if pos.position in ['ST', 'CF', 'RW', 'LW'] %}
                color: #e74c3c;
                {% elif pos.position in ['CAM', 'LM', 'RM', 'CM', 'CDM'] %}
                color: #27ae60;
                {% elif pos.position in ['CB', 'RB', 'LB', 'RWB', 'LWB', 'SW'] %}
                color: #3498db;
                {% elif pos.position == 'GK' %}
                color: #f39c12;
                {% else %}
                color: var(--text-secondary);
                {% endif %}">{{ pos.position }}</div>
                <div class="preferred-pos-value" data-card="2" data-position="{{ pos.position }}"
                    data-original="{{ pos.overall }}"
                    style="font-size: 52px; font-weight: bold; color: var(--text-primary); line-height: 1;">
                    {{ pos.overall }}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // 초기 스탯값 저장
        const originalStats = {
            card1: {},
            card2: {}
        };

        // 강화 단계별 누적 증가값
        const enhanceBonus = {
            0: 0, 1: 0, 2: 1, 3: 2, 4: 4, 5: 6, 6: 8, 7: 11,
            8: 15, 9: 17, 10: 19, 11: 21, 12: 24, 13: 27
        };

        // 초기값 저장
        document.querySelectorAll('.stat-value').forEach(el => {
            const card = el.dataset.card;
            const stat = el.dataset.stat;
            const value = parseInt(el.dataset.original);

            if (!originalStats[`card${card}`][stat]) {
                originalStats[`card${card}`][stat] = value;
            }

            // 초기 색상 적용
            updateColorClass(el, value);
        });

        // 선호 포지션 초기값 저장
        document.querySelectorAll('.preferred-pos-value').forEach(el => {
            const card = el.dataset.card;
            const position = el.dataset.position;
            const value = parseInt(el.dataset.original);

            originalStats[`card${card}`][`pos_${position}`] = value;
        });

        // 스탯 업데이트 함수 (카드별)
        function updateStatsForCard(cardNum) {
            const enhanceLevel = parseInt(document.getElementById(`enhanceLevel${cardNum}`).value);
            const adaptLevel = parseInt(document.getElementById(`adaptLevel${cardNum}`).value);
            const teamColor = parseInt(document.getElementById(`teamColor${cardNum}`).value);

            const enhancementBonus = enhanceBonus[enhanceLevel];
            const adaptBonus = adaptLevel > 0 ? adaptLevel - 1 : 0;
            const totalBonus = enhancementBonus + adaptBonus + teamColor;

            // 해당 카드의 스탯만 업데이트
            document.querySelectorAll(`.stat-value[data-card="${cardNum}"]`).forEach(el => {
                const stat = el.dataset.stat;
                const original = originalStats[`card${cardNum}`][stat];

                if (original !== undefined) {
                    const newValue = original + totalBonus;
                    el.textContent = newValue;
                    updateColorClass(el, newValue);
                }
            });

            // 선호 포지션 오버롤 업데이트
            document.querySelectorAll(`.preferred-pos-value[data-card="${cardNum}"]`).forEach(el => {
                const position = el.dataset.position;
                const original = originalStats[`card${cardNum}`][`pos_${position}`];

                if (original !== undefined) {
                    const newValue = original + totalBonus;
                    el.textContent = newValue;
                }
            });

            // 차이값 업데이트
            updateDifferences();
        }

        // 차이값 재계산
        function updateDifferences() {
            document.querySelectorAll('.stat-comparison-row').forEach(row => {
                const leftContainer = row.querySelector('.stat-left');
                const rightContainer = row.querySelector('.stat-right');
                const leftValue = leftContainer.querySelector('.stat-value');
                const rightValue = rightContainer.querySelector('.stat-value');

                if (leftValue && rightValue) {
                    const left = parseInt(leftValue.textContent);
                    const right = parseInt(rightValue.textContent);
                    const diff = Math.abs(left - right);

                    // 기존 차이값 요소 제거
                    const oldLeftDiff = leftContainer.querySelector('.stat-diff');
                    const oldRightDiff = rightContainer.querySelector('.stat-diff');
                    if (oldLeftDiff) oldLeftDiff.remove();
                    if (oldRightDiff) oldRightDiff.remove();

                    // 새로 생성
                    if (left > right && diff > 0) {
                        const diffSpan = document.createElement('span');
                        diffSpan.className = 'stat-diff left';
                        diffSpan.textContent = `${diff} ▲`;
                        leftContainer.insertBefore(diffSpan, leftValue);
                    } else if (right > left && diff > 0) {
                        const diffSpan = document.createElement('span');
                        diffSpan.className = 'stat-diff';
                        diffSpan.textContent = `▲ ${diff}`;
                        rightContainer.appendChild(diffSpan);
                    }
                }
            });
        }

        // 색상 클래스 업데이트 (card_detail.html과 동일)
        function updateColorClass(element, value) {
            let color;
            if (value >= 160) color = '#40E0D0';
            else if (value >= 150) color = '#FFE34D';
            else if (value >= 140) color = '#FFD700';
            else if (value >= 130) color = '#FF4444';
            else if (value >= 120) color = '#FF88FF';
            else if (value >= 110) color = '#DD77FF';
            else if (value >= 100) color = '#9966FF';
            else if (value >= 90) color = '#5599FF';
            else if (value >= 80) color = '#66CCFF';
            else if (value >= 70) color = '#4A4A4A';
            else color = '#999999';

            element.style.color = color;
        }

        // 이벤트 리스너 등록 (카드1)
        document.getElementById('enhanceLevel1').addEventListener('change', () => updateStatsForCard(1));
        document.getElementById('adaptLevel1').addEventListener('change', () => updateStatsForCard(1));
        document.getElementById('teamColor1').addEventListener('change', () => updateStatsForCard(1));

        // 이벤트 리스너 등록 (카드2)
        document.getElementById('enhanceLevel2').addEventListener('change', () => updateStatsForCard(2));
        document.getElementById('adaptLevel2').addEventListener('change', () => updateStatsForCard(2));
        document.getElementById('teamColor2').addEventListener('change', () => updateStatsForCard(2));

        // 초기 차이값 계산
        updateDifferences();
    });
</script>
{% endblock %}