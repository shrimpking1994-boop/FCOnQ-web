{% extends "index.html" %}

{% block content %}
<div class="container" style="max-width: 1400px; margin: 40px auto; padding: 0 20px;">

    <!-- ìƒë‹¨: ì¹´í…Œê³ ë¦¬ íƒ­ + ê¸€ì“°ê¸° ë²„íŠ¼ -->
    <div
        style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">

        <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
        <div style="flex: 1;">
            <!-- ì²« ì¤„: ì „ì²´ê¸€ + ì¸ê¸°ê¸€ -->
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <a href="/community{% if category %}?category={{ category }}{% endif %}"
                    class="btn {% if not show_popular %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                    style="padding: 8px 20px; border-radius: 6px;">
                    ğŸ“‹ì „ì²´ê¸€
                </a>
                <a href="/community?popular=true{% if category %}&category={{ category }}{% endif %}"
                    class="btn {% if show_popular %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                    style="padding: 8px 20px; border-radius: 6px;">
                    ğŸ”¥ì¸ê¸°ê¸€
                </a>
            </div>

            <!-- ë‘˜ì§¸ ì¤„: ë‚˜ë¨¸ì§€ ì¹´í…Œê³ ë¦¬ë“¤ -->
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <a href="/community?category=ì¡ë‹´{% if show_popular %}&popular=true{% endif %}"
                    class="btn {% if category == 'ì¡ë‹´' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                    style="padding: 8px 20px; border-radius: 20px;">
                    ì¡ë‹´
                </a>
                <a href="/community?category=ê¿€íŒ{% if show_popular %}&popular=true{% endif %}"
                    class="btn {% if category == 'ê¿€íŒ' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                    style="padding: 8px 20px; border-radius: 20px;">
                    ê¿€íŒ
                </a>
                <a href="/community?category=ìŠ¤ì¿¼ë“œ{% if show_popular %}&popular=true{% endif %}"
                    class="btn {% if category == 'ìŠ¤ì¿¼ë“œ' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                    style="padding: 8px 20px; border-radius: 20px;">
                    ìŠ¤ì¿¼ë“œ
                </a>
                <a href="/community?category=ì„ ìˆ˜ í›„ê¸°{% if show_popular %}&popular=true{% endif %}"
                    class="btn {% if category == 'ì„ ìˆ˜ í›„ê¸°' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                    style="padding: 8px 20px; border-radius: 20px;">
                    ì„ ìˆ˜ í›„ê¸°
                </a>
                <a href="/community?category=ì „ìˆ {% if show_popular %}&popular=true{% endif %}"
                    class="btn {% if category == 'ì „ìˆ ' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                    style="padding: 8px 20px; border-radius: 20px;">
                    ì „ìˆ 
                </a>
                <a href="/community?category=ê°•í™”/ë“í…œ{% if show_popular %}&popular=true{% endif %}"
                    class="btn {% if category == 'ê°•í™”/ë“í…œ' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                    style="padding: 8px 20px; border-radius: 20px;">
                    ê°•í™”/ë“í…œ
                </a>
                <a href="/community?category=ê°ë…ëª¨ë“œ{% if show_popular %}&popular=true{% endif %}"
                    class="btn {% if category == 'ê°ë…ëª¨ë“œ' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                    style="padding: 8px 20px; border-radius: 20px;">
                    ê°ë…ëª¨ë“œ
                </a>
                <a href="/community?category=ë¯¸ë‹ˆ í˜ì´ìŠ¤ì˜¨{% if show_popular %}&popular=true{% endif %}"
                    class="btn {% if category == 'ë¯¸ë‹ˆ í˜ì´ìŠ¤ì˜¨' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                    style="padding: 8px 20px; border-radius: 20px;">
                    ë¯¸ë‹ˆ í˜ì´ìŠ¤ì˜¨
                </a>
                <a href="/community?category=ëª…ì¥ë©´{% if show_popular %}&popular=true{% endif %}"
                    class="btn {% if category == 'ëª…ì¥ë©´' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                    style="padding: 8px 20px; border-radius: 20px;">
                    ëª…ì¥ë©´
                </a>
            </div>
        </div>

        <!-- ê¸€ì“°ê¸° ë²„íŠ¼ -->
        <a href="/community/write" class="btn btn-success" style="padding: 8px 24px; font-weight: 600;">
            âœï¸ ê¸€ì“°ê¸°
        </a>
    </div>

    <!-- ê²Œì‹œê¸€ ëª©ë¡ í…Œì´ë¸” -->
    <div class="table-responsive" style="background: var(--card-bg); border-radius: 12px; overflow: hidden;">
        <table class="table table-hover" style="margin: 0; color: var(--text-primary);">
            <thead style="background: var(--secondary-bg); border-bottom: 2px solid var(--border-color);">
                <tr>
                    <th style="width: 80px; text-align: center; padding: 15px 10px;">ë²ˆí˜¸</th>
                    <th style="width: 80px; text-align: center; padding: 15px 10px;">íƒ­</th>
                    <th style="padding: 15px 20px;">ì œëª©</th>
                    <th style="width: 150px; text-align: center; padding: 15px 10px;">ê¸€ì“´ì´</th>
                    <th style="width: 120px; text-align: center; padding: 15px 10px;">ë‚ ì§œ</th>
                    <th style="width: 80px; text-align: center; padding: 15px 10px;">ì¡°íšŒ</th>
                    <th style="width: 80px; text-align: center; padding: 15px 10px;">ì¶”ì²œ</th>
                </tr>
            </thead>
            <tbody>
                {% if posts %}
                {% for post in posts %}
                <tr style="cursor: pointer; border-bottom: 1px solid var(--border-color);"
                    onclick="window.location='/community/post/{{ post.id }}?category={{ category or '' }}'">
                    <td style="text-align: center; padding: 12px 10px; color: var(--text-secondary); font-weight: 500;">
                        {{ post.id }}
                    </td>
                    <td
                        style="text-align: center; padding: 12px 10px; color: var(--text-primary); font-size: 0.9rem; white-space: nowrap;">
                        {{ post.category }}
                    </td>
                    <td style="padding: 12px 20px;">
                        <strong style="color: var(--text-primary); font-size: 1rem;">
                            {{ post.title }}
                            {% if post.has_image %}
                            <span style="margin-left: 6px; font-size: 0.9rem;">ğŸ–¼ï¸</span>
                            {% endif %}
                            {% if post.has_video %}
                            <span
                                style="margin-left: {% if post.has_image %}-5px{% else %}2px{% endif %}; font-size: 0.9rem;">â–¶ï¸</span>
                            {% endif %}
                        </strong>
                    </td>
                    <td style="text-align: center; padding: 12px 10px; color: var(--text-secondary);">
                        {{ post.author }}
                    </td>
                    <td
                        style="text-align: center; padding: 12px 10px; color: var(--text-secondary); font-size: 0.9rem;">
                        {{ post.display_date }}
                    </td>
                    <td style="text-align: center; padding: 12px 10px; color: var(--text-secondary);">
                        {{ post.views }}
                    </td>
                    <td style="text-align: center; padding: 12px 10px; color: var(--text-secondary);">
                        {{ post.likes }}
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="7" style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                        <div style="font-size: 1.2rem; margin-bottom: 10px;">ğŸ“</div>
                        <div>ì•„ì§ ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤</div>
                        <a href="/community/write" class="btn btn-primary" style="margin-top: 20px;">ì²« ê¸€ ì‘ì„±í•˜ê¸°</a>
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- í˜ì´ì§€ë„¤ì´ì…˜ + í•„í„° + ê¸€ì“°ê¸° -->
    <div
        style="display: flex; justify-content: space-between; align-items: center; margin-top: 30px; padding-top: 20px;">

        <!-- ì™¼ìª½: ì „ì²´ê¸€/ì¸ê¸°ê¸€ ë²„íŠ¼ -->
        <div style="display: flex; gap: 10px;">
            <a href="/community{% if category %}?category={{ category }}{% endif %}"
                class="btn {% if not show_popular %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                style="padding: 8px 20px; border-radius: 6px;">
                ğŸ“‹ì „ì²´ê¸€
            </a>
            <a href="/community?popular=true{% if category %}&category={{ category }}{% endif %}"
                class="btn {% if show_popular %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                style="padding: 8px 20px; border-radius: 6px;">
                ğŸ”¥ì¸ê¸°ê¸€
            </a>
        </div>

        <!-- ê°€ìš´ë°: í˜ì´ì§€ë„¤ì´ì…˜ -->
        {% if total_pages > 1 %}
        <nav>
            <ul class="pagination justify-content-center" style="margin: 0;">
                {% if current_page > 1 %}
                <li class="page-item">
                    <a class="page-link"
                        href="/community?{% if show_popular %}popular=true&{% endif %}{% if category %}category={{ category }}&{% endif %}page={{ current_page - 1 }}">ì´ì „</a>
                </li>
                {% endif %}

                {% for p in range(1, total_pages + 1) %}
                <li class="page-item {% if p == current_page %}active{% endif %}">
                    <a class="page-link"
                        href="/community?{% if show_popular %}popular=true&{% endif %}{% if category %}category={{ category }}&{% endif %}page={{ p }}">{{
                        p }}</a>
                </li>
                {% endfor %}

                {% if current_page < total_pages %} <li class="page-item">
                    <a class="page-link"
                        href="/community?{% if show_popular %}popular=true&{% endif %}{% if category %}category={{ category }}&{% endif %}page={{ current_page + 1 }}">ë‹¤ìŒ</a>
                    </li>
                    {% endif %}
            </ul>
        </nav>
        {% endif %}

        <!-- ì˜¤ë¥¸ìª½: ê¸€ì“°ê¸° ë²„íŠ¼ -->
        <a href="/community/write" class="btn btn-success" style="padding: 8px 24px; font-weight: 600;">
            âœï¸ ê¸€ì“°ê¸°
        </a>

    </div>

</div>


<!-- ê²€ìƒ‰ ì˜ì—­ -->
<div class="container" style="max-width: 1400px; margin: 30px auto 0; padding: 0 20px;">
    <div style="display: flex; gap: 10px; align-items: center; max-width: 600px; margin: 0 auto;">
        <select name="search_type" id="searchType" class="form-select"
            style="width: 140px; background: var(--secondary-bg); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px; border-radius: 8px;">
            <option value="title_content" {% if search_type=='title_content' %}selected{% endif %}>ì œëª©+ë‚´ìš©</option>
            <option value="title" {% if search_type=='title' %}selected{% endif %}>ì œëª©</option>
            <option value="content" {% if search_type=='content' %}selected{% endif %}>ë‚´ìš©</option>
            <option value="author" {% if search_type=='author' %}selected{% endif %}>ê¸€ì“´ì´</option>
            <option value="comment" {% if search_type=='comment' %}selected{% endif %}>ëŒ“ê¸€</option>
        </select>

        <input type="text" id="searchKeyword" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="{{ keyword }}"
            style="flex: 1; background: var(--secondary-bg); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px 12px; border-radius: 8px;">

        <button onclick="searchPosts()" class="btn btn-primary" style="padding: 8px 20px; white-space: nowrap;">
            ğŸ” ê²€ìƒ‰
        </button>
    </div>
</div>




<style>
    .table-hover tbody tr:hover {
        background: var(--hover-bg) !important;
    }

    .btn-outline-secondary {
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
    }

    .btn-outline-secondary:hover {
        background: var(--hover-bg);
        color: var(--text-primary);
    }

    /* ê²€ìƒ‰ íƒ€ì… ë“œë¡­ë‹¤ìš´ ë‹¤í¬ëª¨ë“œ ëŒ€ì‘ */
    [data-theme="dark"] .form-select option {
        background: #2d3748;
        color: #ffffff;
    }
</style>

<script>
    function searchPosts() {
        const searchType = document.getElementById('searchType').value;
        const keyword = document.getElementById('searchKeyword').value.trim();

        if (!keyword) {
            alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
            return;
        }

        // í˜„ì¬ ì¹´í…Œê³ ë¦¬ì™€ ì¸ê¸°ê¸€ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
        const currentCategory = '{{ category }}';
        const showPopular = {% if show_popular %} true{% else %} false{% endif %};

    // URL íŒŒë¼ë¯¸í„° êµ¬ì„±
    let url = '/community?';

    // ì¸ê¸°ê¸€ ìƒíƒœ ì¶”ê°€
    if (showPopular) {
        url += 'popular=true&';
    }

    // ì¹´í…Œê³ ë¦¬ ì¶”ê°€
    if (currentCategory) {
        url += `category=${currentCategory}&`;
    }

    // ê²€ìƒ‰ ì¡°ê±´ ì¶”ê°€
    url += `search_type=${searchType}&keyword=${encodeURIComponent(keyword)}`;

    window.location.href = url;
    }

    // ì—”í„°í‚¤ ê²€ìƒ‰
    document.getElementById('searchKeyword').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            searchPosts();
        }
    });
</script>

{% endblock %}