{% extends "index.html" %}

{% block content %}
<div class="container" style="max-width: 1400px; margin: 10px auto; padding: 0 20px;">

    <!-- ìƒë‹¨: ì „ì²´/ì¸ê¸°ê¸€ + ê¸€ì“°ê¸° ë²„íŠ¼ -->
    <div class="community-top-buttons"
        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; gap: 10px;">
        <div style="display: flex; gap: 10px;">
            <a href="/community{% if category %}?category={{ category }}{% endif %}"
                class="btn {% if not show_popular %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                style="padding: 8px 20px; border-radius: 6px;">
                ğŸ“‹ì „ì²´ê¸€
            </a>
            <a href="/community?popular=true{% if category %}&category={{ category }}{% endif %}"
                class="btn {% if show_popular %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                style="padding: 8px 20px; border-radius: 6px;">
                ğŸ”¥ì¸ê¸°ê¸€
            </a>
        </div>

        <!-- ê¸€ì“°ê¸° ë²„íŠ¼ -->
        <a href="/community/write" class="btn btn-success" style="padding: 8px 24px; font-weight: 600;">
            âœï¸ ê¸€ì“°ê¸°
        </a>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ë“¤ -->
    <div class="community-categories" style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 30px;">
        <a href="/community?category=ì¡ë‹´{% if show_popular %}&popular=true{% endif %}"
            class="btn {% if category == 'ì¡ë‹´' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
            style="padding: 8px 20px; border-radius: 20px;">
            ì¡ë‹´
        </a>
        <a href="/community?category=ê¿€íŒ{% if show_popular %}&popular=true{% endif %}"
            class="btn {% if category == 'ê¿€íŒ' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
            style="padding: 8px 20px; border-radius: 20px;">
            ê¿€íŒ
        </a>
        <a href="/community?category=ìŠ¤ì¿¼ë“œ{% if show_popular %}&popular=true{% endif %}"
            class="btn {% if category == 'ìŠ¤ì¿¼ë“œ' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
            style="padding: 8px 20px; border-radius: 20px;">
            ìŠ¤ì¿¼ë“œ
        </a>
        <a href="/community?category=ì„ ìˆ˜ í›„ê¸°{% if show_popular %}&popular=true{% endif %}"
            class="btn {% if category == 'ì„ ìˆ˜ í›„ê¸°' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
            style="padding: 8px 20px; border-radius: 20px;">
            ì„ ìˆ˜ í›„ê¸°
        </a>
        <a href="/community?category=ì „ìˆ {% if show_popular %}&popular=true{% endif %}"
            class="btn {% if category == 'ì „ìˆ ' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
            style="padding: 8px 20px; border-radius: 20px;">
            ì „ìˆ 
        </a>
        <a href="/community?category=ê°•í™”/ë“í…œ{% if show_popular %}&popular=true{% endif %}"
            class="btn {% if category == 'ê°•í™”/ë“í…œ' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
            style="padding: 8px 20px; border-radius: 20px;">
            ê°•í™”/ë“í…œ
        </a>
        <a href="/community?category=ê°ë…ëª¨ë“œ{% if show_popular %}&popular=true{% endif %}"
            class="btn {% if category == 'ê°ë…ëª¨ë“œ' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
            style="padding: 8px 20px; border-radius: 20px;">
            ê°ë…ëª¨ë“œ
        </a>
        <a href="/community?category=ë¯¸ë‹ˆ í˜ì´ìŠ¤ì˜¨{% if show_popular %}&popular=true{% endif %}"
            class="btn {% if category == 'ë¯¸ë‹ˆ í˜ì´ìŠ¤ì˜¨' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
            style="padding: 8px 20px; border-radius: 20px;">
            ë¯¸ë‹ˆ í˜ì´ìŠ¤ì˜¨
        </a>
        <a href="/community?category=ëª…ì¥ë©´{% if show_popular %}&popular=true{% endif %}"
            class="btn {% if category == 'ëª…ì¥ë©´' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
            style="padding: 8px 20px; border-radius: 20px;">
            ëª…ì¥ë©´
        </a>
    </div>
</div>

<div class="container" style="max-width: 1400px; margin: 0 auto; padding: 0 20px;">

    <!-- ê²Œì‹œê¸€ ëª©ë¡ í…Œì´ë¸” -->
    <div class="table-responsive"
        style="background: var(--card-bg); border-radius: 12px; overflow: hidden; margin: 0 -20px; padding: 0 20px;">
        <table class="table table-hover"
            style="margin: 0; color: var(--text-primary); table-layout: fixed; width: 100%;">
            <thead style="background: var(--secondary-bg); border-bottom: 2px solid var(--border-color);">
                <tr>
                    <th style="width: 65px; text-align: center; padding: 15px 10px; ">ë²ˆí˜¸</th>
                    <th style="width: 85px; text-align: center; padding: 15px 10px;">íƒ­</th>
                    <th style="width: 60%; padding: 15px 20px; vertical-align: middle;">ì œëª©</th>
                    <th style="width: 150px; text-align: center; padding: 15px 10px; vertical-align: middle;">ê¸€ì“´ì´</th>
                    <th style="width: 70px; text-align: center; padding: 15px 10px; vertical-align: middle;">ë‚ ì§œ</th>
                    <th style="width: 55px; text-align: center; padding: 15px 10px; vertical-align: middle;">ì¡°íšŒ</th>
                    <th style="width: 55px; text-align: center; padding: 15px 10px; vertical-align: middle;">ì¶”ì²œ</th>
                    {% if session.get('user_role') == 'admin' %}
                    <th style="width: 100px; text-align: center; padding: 15px 10px;">
                        <div style="display: flex; flex-direction: column; gap: 5px; align-items: center;">
                            <button onclick="deleteSelectedPosts()" class="btn btn-sm btn-danger"
                                style="padding: 4px 12px; font-size: 0.85rem; white-space: nowrap;">
                                ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ
                            </button>
                            <label
                                style="font-size: 0.8rem; color: var(--text-secondary); cursor: pointer; user-select: none;">
                                <input type="checkbox" id="selectAll" onclick="toggleSelectAll()"
                                    style="margin-right: 3px;">
                                ì „ì²´ì„ íƒ
                            </label>
                        </div>
                    </th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% if posts %}
                {% for post in posts %}
                <tr style="cursor: pointer; border-bottom: 1px solid var(--border-color); 
                              {% if post.is_deleted %}background: rgba(255, 0, 0, 0.05);
                              {% elif post.is_notice %}background: rgba(255, 152, 0, 0.08);{% endif %}"
                    onclick="window.location='/community/post/{{ post.id }}?category={{ category or '' }}'">
                    <td
                        style="text-align: center; padding: 12px 10px; color: var(--text-secondary); font-weight: 500; vertical-align: middle;">
                        {{ post.id }}
                    </td>
                    <td
                        style="text-align: center; padding: 12px 10px; white-space: nowrap; vertical-align: middle; {% if post.is_notice %}color: #ff9800; font-weight: 600;{% else %}color: var(--text-primary);{% endif %}">
                        {% if post.is_notice %}
                        ğŸ“Œ ê³µì§€
                        {% else %}
                        {% if post.category == 'ë¯¸ë‹ˆ í˜ì´ìŠ¤ì˜¨' %}ë¯¸í˜{% else %}{{ post.category }}{% endif %}
                        {% endif %}
                    </td>
                    <td style="padding: 12px 20px;">
                        <span
                            style="color: var(--text-primary); font-size: 1rem; font-weight: 500; vertical-align: middle;">
                            {% if post.is_deleted and session.get('user_role') == 'admin' %}
                            <span
                                style="background: #ef4444; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; margin-right: 6px;">ì‚­ì œë¨</span>
                            {% endif %}
                            <span class="post-title-text">{{ post.title }}</span>
                            {% if post.comment_count > 0 %}
                            <span style="margin-left: 0px; color: var(--text-primary); font-size: 0.9rem;">[{{
                                post.comment_count }}]</span>
                            {% endif %}
                            {% if post.has_image %}
                            <span style="margin-left: 6px; font-size: 0.9rem;">ğŸ–¼ï¸</span>
                            {% endif %}
                            {% if post.has_video %}
                            <span
                                style="margin-left: {% if post.has_image %}-5px{% else %}6px{% endif %}; font-size: 0.9rem;">â–¶ï¸</span>
                            {% endif %}
                        </span>
                    </td>
                    <td style="text-align: center; padding: 12px 10px; color: var(--text-secondary);">
                        {{ post.author }} <span style="color: var(--text-muted); font-size: 0.85em;">{{ post.ip_display
                            }}</span>
                    </td>
                    <td style="text-align: center; padding: 12px 10px; color: var(--text-secondary);">
                        {{ post.display_date }}
                    </td>
                    <td style="text-align: center; padding: 12px 10px; color: var(--text-secondary);">
                        {{ post.views }}
                    </td>
                    <td style="text-align: center; padding: 12px 10px; color: var(--text-secondary);">
                        {{ post.likes }}
                    </td>
                    {% if session.get('user_role') == 'admin' %}
                    <td style="text-align: center; padding: 12px 10px;" onclick="event.stopPropagation();">
                        {% if not post.is_deleted %}
                        <input type="checkbox" class="post-checkbox" value="{{ post.id }}"
                            style="width: 18px; height: 18px; cursor: pointer;">
                        {% else %}
                        <span style="color: #ef4444; font-size: 0.85rem;">ì‚­ì œë¨</span>
                        {% endif %}
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="7" style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                        <div style="font-size: 1.2rem; margin-bottom: 10px;">ğŸ“</div>
                        <div>ì•„ì§ ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤</div>
                        <a href="/community/write" class="btn btn-primary" style="margin-top: 20px;">ì²« ê¸€ ì‘ì„±í•˜ê¸°</a>
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- í•˜ë‹¨: ì „ì²´/ì¸ê¸°ê¸€ + ê¸€ì“°ê¸° ë²„íŠ¼ -->
    <div class="community-bottom-buttons"
        style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; gap: 10px;">
        <div style="display: flex; gap: 10px;">
            <a href="/community{% if category %}?category={{ category }}{% endif %}"
                class="btn {% if not show_popular %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                style="padding: 8px 20px; border-radius: 6px;">
                ğŸ“‹ì „ì²´ê¸€
            </a>
            <a href="/community?popular=true{% if category %}&category={{ category }}{% endif %}"
                class="btn {% if show_popular %}btn-primary{% else %}btn-outline-secondary{% endif %}"
                style="padding: 8px 20px; border-radius: 6px;">
                ğŸ”¥ì¸ê¸°ê¸€
            </a>
        </div>

        <!-- ê¸€ì“°ê¸° ë²„íŠ¼ -->
        <a href="/community/write" class="btn btn-success" style="padding: 8px 24px; font-weight: 600;">
            âœï¸ ê¸€ì“°ê¸°
        </a>
    </div>

    <!-- ê°€ìš´ë°: í˜ì´ì§€ë„¤ì´ì…˜ -->
    {% if total_pages > 1 %}
    <div style="margin-top: 30px;">
        <nav>
            <ul class="pagination justify-content-center" style="margin: 0;">
                {% if current_page > 1 %}
                <li class="page-item">
                    <a class="page-link"
                        href="/community?{% if show_popular %}popular=true&{% endif %}{% if category %}category={{ category }}&{% endif %}page={{ current_page - 1 }}">ì´ì „</a>
                </li>
                {% endif %}

                {% for p in range(1, total_pages + 1) %}
                <li class="page-item {% if p == current_page %}active{% endif %}">
                    <a class="page-link"
                        href="/community?{% if show_popular %}popular=true&{% endif %}{% if category %}category={{ category }}&{% endif %}page={{ p }}">{{
                        p }}</a>
                </li>
                {% endfor %}

                {% if current_page < total_pages %} <li class="page-item">
                    <a class="page-link"
                        href="/community?{% if show_popular %}popular=true&{% endif %}{% if category %}category={{ category }}&{% endif %}page={{ current_page + 1 }}">ë‹¤ìŒ</a>
                    </li>
                    {% endif %}
            </ul>
        </nav>
    </div>
    {% endif %}
</div>



<!-- ê²€ìƒ‰ ì˜ì—­ -->
<div class="container" style="max-width: 1400px; margin: 30px auto 0; padding: 0 20px;">
    <div style="display: flex; gap: 10px; align-items: center; max-width: 600px; margin: 0 auto;">
        <select name="search_type" id="searchType" class="form-select"
            style="width: 140px; background: var(--secondary-bg); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px; border-radius: 8px;">
            <option value="title_content" {% if search_type=='title_content' %}selected{% endif %}>ì œëª©+ë‚´ìš©</option>
            <option value="title" {% if search_type=='title' %}selected{% endif %}>ì œëª©</option>
            <option value="content" {% if search_type=='content' %}selected{% endif %}>ë‚´ìš©</option>
            <option value="author" {% if search_type=='author' %}selected{% endif %}>ê¸€ì“´ì´</option>
            <option value="comment" {% if search_type=='comment' %}selected{% endif %}>ëŒ“ê¸€</option>
        </select>

        <input type="text" id="searchKeyword" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="{{ keyword }}"
            style="flex: 1; background: var(--secondary-bg); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px 12px; border-radius: 8px;">

        <button onclick="searchPosts()" class="btn btn-primary" style="padding: 8px 20px; white-space: nowrap;">
            ğŸ” ê²€ìƒ‰
        </button>
    </div>
</div>




<style>
    /* ê²€ìƒ‰ íƒ€ì… ë“œë¡­ë‹¤ìš´ ë‹¤í¬ëª¨ë“œ ëŒ€ì‘ */
    .form-select option {
        background: var(--secondary-bg);
        color: var(--text-primary);
    }

    [data-theme="dark"] .form-select option {
        background: #2d3748;
        color: #ffffff;
    }

    /* í…Œì´ë¸” í˜¸ë²„ íš¨ê³¼ */
    .table-hover tbody tr:hover {
        background: var(--hover-bg) !important;
    }

    .btn-outline-secondary {
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
    }

    .btn-outline-secondary:hover {
        background: var(--hover-bg);
        color: var(--text-primary);
    }

    /* í…Œì´ë¸” ì „ì²´ ì •ë ¬ í†µì¼ */
    .table {
        border-collapse: collapse;
    }

    .table thead th {
        vertical-align: middle;
        line-height: 1.4;
    }

    .table tbody td {
        vertical-align: middle !important;
        line-height: 1.4 !important;
        padding: 12px 10px !important;
    }

    /* ì œëª© ì»¬ëŸ¼ë§Œ íŒ¨ë”© ì¡°ì • */
    .table tbody td:nth-child(3) {
        padding: 12px 20px !important;
    }

    /* ì œëª© ë‚´ë¶€ ìš”ì†Œ ì •ë ¬ */
    .post-title-text {
        vertical-align: middle;
        display: inline;
    }

    .table tbody td span {
        vertical-align: middle;
        line-height: 1.4;
    }

    /* í˜ì´ì§€ë„¤ì´ì…˜ ìŠ¤íƒ€ì¼ */
    .pagination {
        margin-top: 30px;
        justify-content: center;
        gap: 5px;
    }

    .pagination .page-item {
        margin: 0;
    }

    .pagination .page-link {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        padding: 8px 14px;
        border-radius: 6px;
        transition: all 0.2s;
    }

    .pagination .page-link:hover {
        background: var(--hover-bg);
        border-color: var(--border-color);
        color: var(--text-primary);
    }

    .pagination .page-item.active .page-link {
        background: #007bff;
        border-color: #007bff;
        color: white;
    }

    .pagination .page-item.disabled .page-link {
        background: var(--card-bg);
        border-color: var(--border-color);
        color: var(--text-muted);
        opacity: 0.5;
    }

    /* ëª¨ë°”ì¼ ëŒ€ì‘ (768px ì´í•˜) */
    @media (max-width: 768px) {

        /* ì»¨í…Œì´ë„ˆ íŒ¨ë”© ì¤„ì´ê¸° */
        .container {
            padding: 0 0px !important;
        }

        /* í…Œì´ë¸” ì¹´ë“œ íŒ¨ë”© ì¤„ì´ê¸° */
        .table tbody tr {
            display: block !important;
            margin-bottom: 10px !important;
            padding: 10px !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 8px !important;
        }

        /* ìƒë‹¨ ë²„íŠ¼ ì˜ì—­ ì—¬ë°± ì¤„ì´ê¸° */
        .community-top-buttons {
            margin-bottom: 10px !important;
        }

        /* ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ì—¬ë°± ì¤„ì´ê¸° */
        .community-categories {
            margin-bottom: 12px !important;
        }

        /* ì»¨í…Œì´ë„ˆ ìƒë‹¨ ì—¬ë°±ë„ ì¤„ì´ê¸° */
        .container:first-of-type {
            margin-top: 0px !important;
            margin-bottom: 0 !important;
        }

        /* ìƒë‹¨/í•˜ë‹¨ ì „ì²´ê¸€+ì¸ê¸°ê¸€+ê¸€ì“°ê¸° ë²„íŠ¼ */
        .community-top-buttons,
        .community-bottom-buttons {
            gap: 6px !important;
        }

        .community-top-buttons .btn,
        .community-bottom-buttons .btn {
            padding: 5px 10px !important;
            font-size: 0.8rem !important;
        }

        /* ê¸€ì“°ê¸° ë²„íŠ¼ */
        .community-top-buttons .btn-success,
        .community-bottom-buttons .btn-success {
            padding: 5px 10px !important;
            font-size: 0.8rem !important;
            font-weight: 400 !important;
        }

        /* ê¸€ì“°ê¸° ë²„íŠ¼ë„ ë™ì¼ í¬ê¸°ë¡œ */
        .community-top-buttons .btn-success,
        .community-bottom-buttons .btn-success {
            padding: 5px 10px !important;
            font-size: 0.8rem !important;
            font-weight: 400 !important;
        }

        /* ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ - ë” ì‘ê²Œ */
        .community-categories .btn {
            padding: 4px 8px !important;
            font-size: 0.75rem !important;
        }

        /* í…Œì´ë¸” ëª¨ë°”ì¼ ìµœì í™” */
        .table-responsive {
            overflow-x: visible !important;
            margin: 0 !important;
            padding: 0 2px !important;
        }

        .table thead {
            display: none !important;
        }

        .table tbody tr {
            display: flex !important;
            flex-wrap: wrap !important;
            margin-bottom: 12px !important;
            padding: 6px 12px !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 8px !important;
        }

        .table tbody td {
            display: inline !important;
            padding: 0 !important;
            border: none !important;
        }

        /* ë‘ ë²ˆì§¸ ì¤„ ëª¨ë“  ìš”ì†Œ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .table tbody td:nth-child(2),
        .table tbody td:nth-child(4),
        .table tbody td:nth-child(5),
        .table tbody td:nth-child(6),
        .table tbody td:nth-child(7) {
            font-size: 0.75rem !important;
            line-height: 1.5 !important;
            color: var(--text-secondary) !important;
            padding: 0 2px !important;
        }

        /* ë²ˆí˜¸ ìˆ¨ê¸°ê¸° */
        .table tbody td:nth-child(1) {
            display: none !important;
        }

        /* íƒ­ - ë‘˜ì§¸ ì¤„ ì²« ë²ˆì§¸ */
        .table tbody td:nth-child(2) {
            order: 2 !important;
        }

        .table tbody td:nth-child(2)::after {
            content: ' | ';
        }

        /* ì œëª© - ì²« ì¤„ ì „ì²´ */
        .table tbody td:nth-child(3) {
            display: block !important;
            order: 1 !important;
            width: 100% !important;
            font-size: 0.95rem !important;
            font-weight: 600 !important;
            margin-bottom: 5px !important;
            padding: 0 !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            white-space: nowrap !important;
            max-width: 100% !important;
        }

        /* ì œëª© í…ìŠ¤íŠ¸ ê¸¸ì´ ì œí•œ ì œê±° */
        .post-title-text {
            max-width: none !important;
            overflow: visible !important;
            text-overflow: inherit !important;
        }

        /* ê¸€ì“´ì´ */
        .table tbody td:nth-child(4) {
            order: 3 !important;
        }

        .table tbody td:nth-child(4)::after {
            content: ' | ';
        }

        /* ë‚ ì§œ */
        .table tbody td:nth-child(5) {
            order: 4 !important;
        }

        .table tbody td:nth-child(5)::after {
            content: ' | ';
        }

        /* ì¡°íšŒ */
        .table tbody td:nth-child(6) {
            order: 5 !important;
        }

        .table tbody td:nth-child(6)::before {
            content: 'ì¡°íšŒ ';
        }

        .table tbody td:nth-child(6)::after {
            content: ' | ';
        }

        /* ì¶”ì²œ */
        .table tbody td:nth-child(7) {
            order: 6 !important;
        }

        .table tbody td:nth-child(7)::before {
            content: 'ì¶”ì²œ ';
        }

        /* í˜ì´ì§€ë„¤ì´ì…˜ ëª¨ë°”ì¼ ìµœì í™” */
        .pagination .page-item {
            font-size: 0.85rem !important;
        }

        .pagination .page-link {
            padding: 6px 10px !important;
            font-size: 0.85rem !important;
        }

        /* í˜ì´ì§€ ë²ˆí˜¸ 6ë²ˆì§¸ ì´í›„ ìˆ¨ê¸°ê¸° (1,2,3,4,5ë§Œ í‘œì‹œ) */
        .pagination .page-item:nth-child(n+7):not(:last-child):not(:nth-last-child(2)) {
            display: none !important;
        }

        /* ê²€ìƒ‰ ì˜ì—­ ì™„ì „ ìˆ˜ì • */
        .container>div[style*="max-width: 600px"] {
            max-width: 100% !important;
            gap: 6px !important;
            flex-wrap: nowrap !important;
        }

        #searchType {
            width: 90px !important;
            min-width: 90px !important;
            font-size: 0.75rem !important;
            padding: 6px 4px !important;
        }

        #searchKeyword {
            flex: 1 !important;
            min-width: 0 !important;
            font-size: 0.75rem !important;
            padding: 6px 8px !important;
        }

        button[onclick="searchPosts()"] {
            flex-shrink: 0 !important;
            font-size: 0.75rem !important;
            padding: 6px 10px !important;
            white-space: nowrap !important;
        }

        /* ì²« ë²ˆì§¸ ê²Œì‹œê¸€ ìœ„ ì„  ì œê±° */
        .table tbody tr:first-child {
            margin-top: 0 !important;
        }

        /* ë§ˆì§€ë§‰ ê²Œì‹œê¸€ ì•„ë˜ ì—¬ë°± ì œê±° */
        .table tbody tr:last-child {
            margin-bottom: 0 !important;
        }

        /* í…Œì´ë¸” ì „ì²´ border ì œê±° */
        .table {
            border: none !important;
        }

        .table tbody {
            border: none !important;
        }

        /* table-responsive ìŠ¤íƒ€ì¼ ì™„ì „ ì œê±° */
        .table-responsive[style*="border-radius"] {
            border-radius: 0 !important;
            overflow: visible !important;
        }
    }
</style>

<script>
    function adminDeletePost(postId) {
        if (!confirm('ì •ë§ë¡œ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ê²Œì‹œê¸€ì€ ê´€ë¦¬ìë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
            return;
        }

        fetch(`/community/post/${postId}/admin_delete`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                    location.reload();
                } else {
                    alert(data.message || 'ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            });
    }

    // ì „ì²´ ì„ íƒ/í•´ì œ í† ê¸€
    function toggleSelectAll() {
        const selectAllCheckbox = document.getElementById('selectAll');
        const checkboxes = document.querySelectorAll('.post-checkbox');

        checkboxes.forEach(checkbox => {
            checkbox.checked = selectAllCheckbox.checked;
        });
    }

    // ì„ íƒëœ ê²Œì‹œê¸€ ì¼ê´„ ì‚­ì œ
    function deleteSelectedPosts() {
        const checkboxes = document.querySelectorAll('.post-checkbox:checked');

        if (checkboxes.length === 0) {
            alert('ì‚­ì œí•  ê²Œì‹œê¸€ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
            return;
        }

        const postIds = Array.from(checkboxes).map(cb => cb.value);
        const confirmMessage = `ì„ íƒí•œ ${postIds.length}ê°œì˜ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ê²Œì‹œê¸€ì€ ê´€ë¦¬ìë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;

        if (!confirm(confirmMessage)) {
            return;
        }

        // ê° ê²Œì‹œê¸€ ìˆœì°¨ì ìœ¼ë¡œ ì‚­ì œ
        let successCount = 0;
        let errorCount = 0;

        Promise.all(postIds.map(postId =>
            fetch(`/community/post/${postId}/admin_delete`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        successCount++;
                    } else {
                        errorCount++;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    errorCount++;
                })
        ))
            .then(() => {
                alert(`ì‚­ì œ ì™„ë£Œ\nì„±ê³µ: ${successCount}ê°œ / ì‹¤íŒ¨: ${errorCount}ê°œ`);
                location.reload();
            });
    }

    function searchPosts() {
        const searchType = document.getElementById('searchType').value;
        const keyword = document.getElementById('searchKeyword').value.trim();

        if (!keyword) {
            alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
            return;
        }

        // í˜„ì¬ ì¹´í…Œê³ ë¦¬ì™€ ì¸ê¸°ê¸€ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
        const currentCategory = '{{ category }}';
        const showPopular = {% if show_popular %} true{% else %} false{% endif %};

    // URL íŒŒë¼ë¯¸í„° êµ¬ì„±
    let url = '/community?';

    // ì¸ê¸°ê¸€ ìƒíƒœ ì¶”ê°€
    if (showPopular) {
        url += 'popular=true&';
    }

    // ì¹´í…Œê³ ë¦¬ ì¶”ê°€
    if (currentCategory) {
        url += `category=${currentCategory}&`;
    }

    // ê²€ìƒ‰ ì¡°ê±´ ì¶”ê°€
    url += `search_type=${searchType}&keyword=${encodeURIComponent(keyword)}`;

    window.location.href = url;
    }

    // ì—”í„°í‚¤ ê²€ìƒ‰
    document.getElementById('searchKeyword').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            searchPosts();
        }
    });
</script>

{% endblock %}