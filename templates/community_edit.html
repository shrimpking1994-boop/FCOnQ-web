{% extends "index.html" %}

{% block content %}
<div class="container" style="max-width: 900px; margin: 40px auto; padding: 0 20px;">

    <h3 style="color: var(--text-primary); margin-bottom: 30px; font-weight: 600;">âœï¸ ê¸€ ìˆ˜ì •</h3>

    <form method="POST" action="/community/post/{{ post.id }}/edit"
        style="background: var(--card-bg); padding: 30px; border-radius: 12px;">

        <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
        <div class="mb-4">
            <label style="color: var(--text-primary); font-weight: 500; margin-bottom: 10px; display: block;">
                ì¹´í…Œê³ ë¦¬ <span style="color: #ff4444;">*</span>
            </label>
            <select name="category" required class="form-select" style="background: var(--secondary-bg); 
               border: 1px solid var(--border-color); 
               color: var(--text-primary); 
               padding: 10px; 
               border-radius: 8px;">
                <option value="">ê¸€ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                <option value="ì¡ë‹´" {% if post.category=='ì¡ë‹´' %}selected{% endif %}>ì¡ë‹´</option>
                <option value="ê¿€íŒ" {% if post.category=='ê¿€íŒ' %}selected{% endif %}>ê¿€íŒ</option>
                <option value="ìŠ¤ì¿¼ë“œ" {% if post.category=='ìŠ¤ì¿¼ë“œ' %}selected{% endif %}>ìŠ¤ì¿¼ë“œ</option>
                <option value="ì„ ìˆ˜ í›„ê¸°" {% if post.category=='ì„ ìˆ˜ í›„ê¸°' %}selected{% endif %}>ì„ ìˆ˜ í›„ê¸°</option>
                <option value="ì „ìˆ " {% if post.category=='ì „ìˆ ' %}selected{% endif %}>ì „ìˆ </option>
                <option value="ê°•í™”/ë“í…œ" {% if post.category=='ê°•í™”/ë“í…œ' %}selected{% endif %}>ê°•í™”/ë“í…œ</option>
                <option value="ê°ë…ëª¨ë“œ" {% if post.category=='ê°ë…ëª¨ë“œ' %}selected{% endif %}>ê°ë…ëª¨ë“œ</option>
                <option value="ë¯¸ë‹ˆ í˜ì´ìŠ¤ì˜¨" {% if post.category=='ë¯¸ë‹ˆ í˜ì´ìŠ¤ì˜¨' %}selected{% endif %}>ë¯¸ë‹ˆ í˜ì´ìŠ¤ì˜¨</option>
                <option value="ëª…ì¥ë©´" {% if post.category=='ëª…ì¥ë©´' %}selected{% endif %}>ëª…ì¥ë©´</option>
            </select>
        </div>

        <!-- ì œëª© ì…ë ¥ -->
        <div class="mb-4">
            <label style="color: var(--text-primary); font-weight: 500; margin-bottom: 10px; display: block;">
                ì œëª© <span style="color: #ff4444;">*</span>
            </label>
            <input type="text" name="title" required maxlength="200" value="{{ post.title }}" class="form-control"
                style="background: var(--secondary-bg); border: 1px solid var(--border-color); color: var(--text-primary); padding: 12px; border-radius: 8px;">
        </div>

        <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (ë¹„ë¡œê·¸ì¸ ì‹œì—ë§Œ í‘œì‹œ) -->
        {% if not session.get('user_id') %}
        <div class="mb-4">
            <label style="color: var(--text-primary); font-weight: 500; margin-bottom: 10px; display: block;">
                ë¹„ë°€ë²ˆí˜¸ í™•ì¸ <span style="color: #ff4444;">*</span>
            </label>
            <input type="password" name="password" required maxlength="50" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”"
                class="form-control"
                style="background: var(--secondary-bg); border: 1px solid var(--border-color); color: var(--text-primary); padding: 12px; border-radius: 8px;">
            <small style="color: var(--text-secondary); margin-top: 5px; display: block;">
                ğŸ”’ ìˆ˜ì •ì„ ì™„ë£Œí•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”
            </small>
        </div>
        {% endif %}

        <!-- ë‚´ìš© ì…ë ¥ -->
        <div class="mb-4">
            <label style="color: var(--text-primary); font-weight: 500; margin-bottom: 10px; display: block;">
                ë‚´ìš© <span style="color: #ff4444;">*</span>
            </label>
            <div id="editor"
                style="background: var(--secondary-bg); border: 1px solid var(--border-color); border-radius: 8px; min-height: 400px;">
            </div>
            <input type="hidden" name="content" id="content" required>
        </div>

        <!-- ë²„íŠ¼ -->
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
            <a href="/community/post/{{ post.id }}" class="btn btn-secondary" style="padding: 10px 30px;">ì·¨ì†Œ</a>
            <button type="submit" class="btn btn-success" style="padding: 10px 30px; font-weight: 600;">ìˆ˜ì •ì™„ë£Œ</button>
        </div>

    </form>

</div>

<!-- Quill ì—ë””í„° -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<script>
    // Quill ì—ë””í„° ì´ˆê¸°í™”
    var quill = new Quill('#editor', {
        theme: 'snow',
        placeholder: 'ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...',
        modules: {
            toolbar: [
                [{ 'header': [1, 2, 3, false] }],
                ['bold', 'italic', 'underline', 'strike'],
                ['blockquote', 'code-block'],
                [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                [{ 'color': [] }, { 'background': [] }],
                ['link', 'image', 'video'],
                ['clean']
            ]
        }
    });

    // ê¸°ì¡´ ë‚´ìš© ë¡œë“œ
    quill.root.innerHTML = `{{ post.content | safe }}`;

    // í¼ ì œì¶œ ì‹œ ì—ë””í„° ë‚´ìš©ì„ hidden inputì— ì €ì¥
    document.querySelector('form').onsubmit = function () {
        var content = document.querySelector('#content');
        content.value = quill.root.innerHTML;

        // ë¹ˆ ë‚´ìš© ì²´í¬
        if (quill.getText().trim().length === 0) {
            alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
            return false;
        }

        return true;
    };

    // ë‹¤í¬ëª¨ë“œ ëŒ€ì‘: Quill ì—ë””í„° ìŠ¤íƒ€ì¼ ì¡°ì •
    if (document.documentElement.getAttribute('data-theme') === 'dark') {
        document.querySelector('.ql-toolbar').style.background = 'var(--secondary-bg)';
        document.querySelector('.ql-toolbar').style.borderColor = 'var(--border-color)';
        document.querySelector('.ql-container').style.borderColor = 'var(--border-color)';
    }
</script>

<style>
    /* community_write.htmlê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼ */
    [data-theme="dark"] .form-select option {
        background: #2d3748;
        color: #ffffff;
    }

    .ql-toolbar {
        background: var(--secondary-bg) !important;
        border-color: var(--border-color) !important;
        border-radius: 8px 8px 0 0 !important;
    }

    .ql-container {
        border-color: var(--border-color) !important;
        border-radius: 0 0 8px 8px !important;
        font-size: 1rem;
    }

    .ql-editor {
        min-height: 400px;
        color: var(--text-primary) !important;
    }

    .ql-editor strong {
        font-weight: bold !important;
    }

    .ql-editor em {
        font-style: italic !important;
    }

    .ql-editor u {
        text-decoration: underline !important;
    }

    .ql-editor s {
        text-decoration: line-through !important;
    }

    .ql-editor h1,
    .ql-editor h2,
    .ql-editor h3 {
        font-weight: bold !important;
    }

    .ql-editor.ql-blank::before {
        color: var(--text-secondary) !important;
    }

    .ql-stroke {
        stroke: var(--text-primary) !important;
    }

    .ql-fill {
        fill: var(--text-primary) !important;
    }

    .ql-picker-label {
        color: var(--text-primary) !important;
    }

    .ql-editor iframe {
        max-width: 100% !important;
        width: 100% !important;
        aspect-ratio: 16 / 9 !important;
        height: auto !important;
        border-radius: 8px !important;
        margin: 20px 0 !important;
    }

    @supports not (aspect-ratio: 16 / 9) {
        .ql-editor iframe {
            height: 450px !important;
        }
    }

    @media (max-width: 768px) {
        @supports not (aspect-ratio: 16 / 9) {
            .ql-editor iframe {
                height: 300px !important;
            }
        }
    }
</style>
{% endblock %}
```